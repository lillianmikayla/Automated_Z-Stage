#define STEP_PIN 5
#define DIR_PIN  2

const int STEPS = 1600;  // about 1 rev with your microstep setting

void stepPulse(unsigned int usDelay) {
  digitalWrite(STEP_PIN, HIGH);
  delayMicroseconds(10);
  digitalWrite(STEP_PIN, LOW);
  delayMicroseconds(usDelay);
}

void setup() {
  pinMode(STEP_PIN, OUTPUT);
  pinMode(DIR_PIN, OUTPUT);
  digitalWrite(DIR_PIN, HIGH);
  delay(200);
}

void loop() {
  // Ramp from slow to faster
  for (unsigned int d = 2000; d > 200; d -= 20) { // delay in us between steps
    stepPulse(d);
  }

  // Run steady speed for ~1 rev
  for (int i = 0; i < STEPS; i++) {
    stepPulse(200);
  }

  delay(500);

  // Reverse
    digitalWrite(DIR_PIN, !digitalRead(DIR_PIN));
    delayMicroseconds(10);

  delay(500);
}
